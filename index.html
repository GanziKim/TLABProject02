<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" href="css/common.css">
<script src="js/jquery-1.11.3.min.js"></script>
<script type="text/javascript">
	/* 초기화에 사용될 변수와 값 */
	var headerImage = "images/tab_1_on.png";
	var footer = "images/main_btn_unfocus.png";
	var upDown = 1;
	var headerImageNum = 1;
	var bodyImageMove = 1;
	var posterMoving = 1;
	var size = 6;
	var pageSize = 6;
	var data;
	
	var $body_2 = "<div><div class='addingBodyBallonImage'>"
	 + "<img><img><span></span>"
	 + "</div><div class='addingBodyPosterImage'><span id='poster_focus'><img></span>"
	 + "<img></div><div class='addingBodyFooterImage'><img></div></div>";
	 
	 
	var $body_3 = "<img id='third_ballon'>"
		+ "<img id='machine1'>"
		+ "<img id='machine2'>"
		+ "<img id='ani'>"
		+ "<img id='machine_top'>";
		
		
	$(function() { //$(document).ready(function(){ }) 와 같음

		 $.ajax({
				url : "http://fif.hpp.kt.com/pageService/getPageInfo.json",
				dataType : "JSON",
				data : {
					pageId  : "D1GMJM000000000SVHPP",
					said : "11111111111",
					stbModel : "123123123",
					platformType : "WEB"
				},
				success : function(result){ 
					if(result.hpp.result == 'SUCCESS'){
						data = result;
						document.addEventListener('keydown', keydownhandler);  /* 데이터 가져오기 성공시 실행 될 함수 */	
						Drawing(headerImageNum); 
					}
				},
				error : function(request, status, error){
					alert("code:"+request.status + "\n" + "message:"  + request.responseText + "\n" + "error:" + error);
				}
			});
	});

	/* 구성페이지 전환 */
	function Drawing(headerImageNum) {
		$("#headerImage").attr("src", "images/tab_1_on.png"); /* header */
		$("#headerNum").text("9999")
		$("#headerTxt").text("나의 "+ data.hpp.mileageName);
		$("header>span:nth-child(2)>img").attr("src", data.hpp.pageImages.mileageNormalSize);
		headerImageNum = (headerImageNum <= 0 ? 2 - (headerImageNum * (-1) % 3) : (headerImageNum - 1) % 3);
		switch (headerImageNum) {
		case 0:
			$("#addingGiftBodyImage").empty();
			$("#addingPullBodyImage").empty();
			$("#footerImage").empty();
			$("#bodyImage").attr("src", data.hpp.pageImages.operationGuide[0]); /* body */
			
			$("#footerImage").append("<img >");  /* footer */
			$("#footerImage>img").attr("src", footer);
			break;
		case 1:
			$("#addingPullBodyImage").empty();
			$("#footerImage").empty();
			$("#headerImage").attr("src", "images/tab_2_on.png"); /* header */
			
			/* body */
			$("#bodyImage").attr("src", data.hpp.pageImages.exchangeBackground);
			
			posterOutput(size, 1);
			
			$("#footerImage").append("<img >");  /* footer */
			$("#footerImage>img").attr("src", footer);
			$("#addingGiftBodyImage").show();
			break;
		case 2:
			$("#headerImage").attr("src", "images/tab_3_on.png"); /* header */
			$("#addingGiftBodyImage").empty();
			$("#footerImage").empty();
			$("#bodyImage").attr("src", data.hpp.pageImages.randomboxBackground);  /* body */
			
			$("#addingPullBodyImage").append($body_3);
			$("#third_ballon").attr("src","images/textballoon_unfocus.png");
			$("#machine_top").attr("src","images/machine_top.png");
			$("#machine2").attr("src","images/machine2.png");
			$("#machine1").attr("src","images/machine1.png");
			$("#ani").attr("src","images/ani-01.png");
			
			$("#footerImage").append("<img > <img > <img >");  /* footer */
			$("#footerImage>img").attr("src", footer); 	
			break;
		}
	}
	
	/* 포스터 출력 */
	function posterOutput(size, posterMoving){
		$("#addingGiftBodyImage").empty();
		var $arrow_left = "images/arrows_left.png";
		var $arrow_right = "images/arrows_right.png";
		if(size > 6){
			var $right = $("article>img:nth-child(2)").attr('src',$arrow_right);
		}else if(size >= 6){
			var $left = $("article>img:nth-child(1)").attr('src',$arrow_left);
		}
		
		/* 토탈 값 계산 */
		var pageNum = (parseInt(posterMoving / pageSize)*5) + 1;
		var max = 5 * pageNum;
		if(max > size)
			max = size;
		
		for(var i =  pageNum; i <= max; i++){
			$("#addingGiftBodyImage").append($body_2);
			$(".addingBodyBallonImage>img:nth-child(1)").attr("src", "images/textballoon_unfocus.png");
			$(".addingBodyBallonImage>img:nth-child(2)").attr("src", data.hpp.pageImages.mileageMiniSizeWhite);
			$(".addingBodyBallonImage>span:nth-child("+(i - (5 * parseInt(i/pageSize)))+")").text(data.hpp.exchange[i-1].reward[0].rewardContent[0].originalPrice);
			$("#addingGiftBodyImage>div:nth-child("+(i - (5 * parseInt(i/pageSize)))+")>.addingBodyPosterImage>img").attr("src", data.hpp.exchange[i-1].reward[0].rewardImg);
			$(".addingBodyFooterImage>img").attr("src", "images/poster_sh.png");
		}
	}
	
	/*  포스터 이동 */
	function bodyDrawing(upDown, focusImage){
		focusImage = focusImage - (5 * parseInt(focusImage / pageSize));
		if(upDown != 2 ){
			$(".addingBodyBallonImage>img:nth-child(1)").attr("src","images/textballoon_unfocus.png");
			$("#addingGiftBodyImage>div>.addingBodyPosterImage>span>img").removeAttr("src");
		}else{
			$("#addingGiftBodyImage>div:nth-child("+(focusImage-1)+")>div:nth-child(1)>img:nth-child(1)").attr("src","images/textballoon_unfocus.png")
			$("#addingGiftBodyImage>div:nth-child("+(focusImage+1)+")>div:nth-child(1)>img:nth-child(1)").attr("src","images/textballoon_unfocus.png")
			$("#addingGiftBodyImage>div:nth-child("+focusImage+")>div:nth-child(1)>img:nth-child(1)").attr("src","images/textballoon_focus.png")
			
			$("#addingGiftBodyImage>div:nth-child("+focusImage+")>.addingBodyPosterImage>span>img").attr("src", "images/poster_focus_199x264.png");
			$("#addingGiftBodyImage>div:nth-child("+(focusImage-1)+")>.addingBodyPosterImage>span>img").removeAttr("src");
			$("#addingGiftBodyImage>div:nth-child("+(focusImage+1)+")>.addingBodyPosterImage>span>img").removeAttr("src");
		}
		if(upDown != 3){
			$("#footerImage>img").attr('src', footer);
		}else{
			$("#footerImage>img").attr('src','images/main_btn_focus.png');
		}
	}
	
	/* header 잠금 */
	function locking(lockImageNum, upDown) {
		lockImageNum = 	(lockImageNum <= 0 ? 2 - (lockImageNum * (-1) % 3) : (lockImageNum - 1) % 3)
		if(upDown == 1){
			$("#headerImage").attr('src', "images/tab_" + (lockImageNum+1) + "_sel.png")
		}else if(upDown == 2){
			$("#headerImage").attr('src', "images/tab_" + (lockImageNum+1) + "_on.png")
		}
	}

	function keydownhandler(event) {
		switch (event.keyCode) {
		case 37:
			if (upDown == 1) {
				Drawing(--headerImageNum);
			} else if (upDown == 2) {
				if(headerImageNum ==2  && bodyImageMove > 1){
					--bodyImageMove;
					if(headerImageNum == 2)
						posterOutput(size, bodyImageMove);
				}
				bodyDrawing(2, bodyImageMove);
			} else if (upDown == 3) {

			}
			break;
		case 38:
			if (upDown == 2) {
				locking(headerImageNum, upDown);
				--upDown;
				bodyDrawing(upDown, 1);
			} else if (upDown == 3) {
				--upDown;
				bodyDrawing(upDown,bodyImageMove);
			}
			break;
		case 39:
			if (upDown == 1) {
				Drawing(++headerImageNum);
			} else if (upDown == 2) {
				if(headerImageNum ==2  && bodyImageMove < size){
					++bodyImageMove;
					if(headerImageNum == 2)
					posterOutput(size, bodyImageMove);
				}
				bodyDrawing(2, bodyImageMove);
			} else if (upDown == 3) {

			}
			break;
		case 40:
			if (upDown == 1) {
				locking(headerImageNum, upDown);
				++upDown;
				bodyImageMove = 1;
				if(headerImageNum == 2)
					posterOutput(size, bodyImageMove);
				bodyDrawing(upDown, 1);
			} else if (upDown == 2) {
				++upDown;
				bodyDrawing(upDown, 1);
			}
			break;
		case 13: 
			if(upDown == 3 && headerImageNum == 3){
				var randomValue = 0;
				var loop = 0;//7의 배수
			var random = function(){
				randomValue++;
				loop++;
				console.log("loop"+ loop);
				if(loop >= 22){
					$("#ani").attr("src","images/ani-01.png");
					return;
				}
				if(randomValue < 7){
					$("#ani").attr("src","images/ani-0"+ randomValue +".png");
					}else{
						randomValue = 0;
					}
				setTimeout(random, 100);
				}//end function random();
			setTimeout(random, 500);
			}// end if
		} //end swtich;
	}// end keydownhandler();
</script>
</head>
<body>
	<div id="main">
		<header>
			<!-- header -->
			<span><img id="headerImage"></span> <span>
			<img ></span> <span id="headerNum"></span> <span
				id="headerTxt"></span>
		</header>

		<article>
		
			<!-- body -->
			<span><img id="bodyImage"></span>
				<img >
				<img >
			<div id="addingGiftBodyImage"></div>  <!-- 선물교환 페이지에서만 등장 -->
			<div id="addingPullBodyImage"></div>  <!-- 뽑기 페이지에서만 등장 -->
		</article>

		<footer>
			<!-- footer -->
			<span id="footerImage"></span>
		</footer>
		<div id="test"></div>
	</div>
</body>